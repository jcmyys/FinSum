<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>주식 5종목 최근 10거래일 종가 (최고가 표시)</title>
  <style>
    table {
      border-collapse: collapse;
      width: 90%;
      margin-top: 20px;
      text-align: center;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
    }
    th {
      background-color: #f4f4f4;
    }
    .highest {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>AAPL, SPLG, MSFT, AMD, UEC 최근 10거래일 종가 (최고가 빨간색 표시)</h2>
  <table id="stock-table">
    <thead>
      <tr>
        <th>날짜</th>
        <th>AAPL</th>
        <th>SPLG</th>
        <th>MSFT</th>
        <th>AMD</th>
        <th>UEC</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const apiKey = 'UAN4E6AQL39DPU6H';
    const symbols = ['AAPL', 'SPLG', 'MSFT', 'AMD', 'UEC'];
    const daysToShow = 10;

    async function fetchSymbolData(symbol) {
      const url = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol}&apikey=${apiKey}`;
      const response = await fetch(url);
      const data = await response.json();
      const timeSeries = data['Time Series (Daily)'];
      if (!timeSeries) {
        throw new Error(`${symbol} 데이터 불러오기 실패`);
      }
      const entries = Object.entries(timeSeries).slice(0, daysToShow);
      const closePrices = {};
      entries.forEach(([date, dailyData]) => {
        closePrices[date] = parseFloat(dailyData['4. close']);
      });
      return closePrices;
    }

    async function fetchAllData() {
      const allData = {};
      for (const symbol of symbols) {
        try {
          allData[symbol] = await fetchSymbolData(symbol);
        } catch (error) {
          console.error(error);
          alert(`${symbol} 주가 데이터를 불러오는 데 실패했습니다.`);
          return;
        }
      }

      // 각 종목별 최고 종가 계산
      const highestPrices = {};
      symbols.forEach(sym => {
        const prices = Object.values(allData[sym]);
        highestPrices[sym] = Math.max(...prices);
      });

      // 날짜 집합 생성 (최신순 정렬 후 최근 10개)
      const datesSet = new Set();
      symbols.forEach(sym => {
        Object.keys(allData[sym]).forEach(date => datesSet.add(date));
      });
      const dates = Array.from(datesSet).sort((a,b) => b.localeCompare(a)).slice(0, daysToShow);

      const tbody = document.querySelector('#stock-table tbody');
      tbody.innerHTML = '';

      dates.forEach(date => {
        const tr = document.createElement('tr');
        let rowHtml = `<td>${date}</td>`;
        symbols.forEach(sym => {
          const price = allData[sym][date];
          if (price !== undefined && price === highestPrices[sym]) {
            rowHtml += `<td class="highest">${price.toFixed(2)}</td>`;
          } else if (price !== undefined) {
            rowHtml += `<td>${price.toFixed(2)}</td>`;
          } else {
            rowHtml += `<td>-</td>`;
          }
        });
        tr.innerHTML = rowHtml;
        tbody.appendChild(tr);
      });
    }

    fetchAllData();
  </script>
</body>
</html>
